# MCPæµè§ˆå™¨æœåŠ¡å™¨è°ƒè¯•æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

å¦‚æœä½ é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè°ƒè¯•ï¼š

### 1. ç¯å¢ƒæ£€æŸ¥

```bash
# æ£€æŸ¥ç¯å¢ƒæ˜¯å¦æ­£ç¡®é…ç½®
node debug/debug-utils.js --check
```

### 2. Chromeè¿æ¥æµ‹è¯•

```bash
# æµ‹è¯•Chromeè°ƒè¯•ç«¯å£è¿æ¥
npm run test-chrome
```

### 3. Base64ç¼–ç æµ‹è¯•

```bash
# ä¸“é—¨æµ‹è¯•æˆªå›¾Base64ç¼–ç é—®é¢˜
npm run test-base64
```

### 4. å®Œæ•´MCPæœåŠ¡å™¨æµ‹è¯•

```bash
# æµ‹è¯•å®Œæ•´çš„MCPåè®®é€šä¿¡
npm run test
```

## ğŸ› ï¸ è°ƒè¯•å·¥å…·è¯´æ˜

### 1. Chromeè¿æ¥æµ‹è¯• (`test-chrome-connection.js`)

**ç”¨é€”**: éªŒè¯Chromeè°ƒè¯•ç«¯å£è¿æ¥å’Œæˆªå›¾åŠŸèƒ½
**å‘½ä»¤**: `npm run test-chrome`

**æµ‹è¯•å†…å®¹**:
- æ£€æµ‹å¸¸è§è°ƒè¯•ç«¯å£ (9222, 9223, 9224)
- è‡ªåŠ¨å‘ç°Chromeå®ä¾‹
- WebSocketè¿æ¥æµ‹è¯•
- æˆªå›¾åŠŸèƒ½éªŒè¯
- Base64æ ¼å¼æ£€æŸ¥

**å¸¸è§é—®é¢˜**:
- Chromeæœªå¯åŠ¨è°ƒè¯•æ¨¡å¼ â†’ è¿è¡Œ `./start-chrome-debug.sh`
- ç«¯å£è¢«å ç”¨ â†’ æ£€æŸ¥ `lsof -i :9222`
- é˜²ç«å¢™é˜»æ­¢ â†’ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. MCPåè®®æµ‹è¯• (`test-mcp-server.js`)

**ç”¨é€”**: æµ‹è¯•å®Œæ•´çš„MCPæœåŠ¡å™¨åŠŸèƒ½å’Œå·¥å…·è°ƒç”¨
**å‘½ä»¤**: `npm run test`

**æµ‹è¯•å†…å®¹**:
- å·¥å…·åˆ—è¡¨æŸ¥è¯¢
- æµè§ˆå™¨å¯åŠ¨è¿æ¥
- é¡µé¢å¯¼èˆª
- é¡µé¢å†…å®¹è·å–
- æµè§ˆå™¨å…³é—­

**è¾“å‡ºä¿¡æ¯**:
- ğŸ“¤ å‘é€çš„è¯·æ±‚
- ğŸ“¥ æ”¶åˆ°çš„å“åº”
- âœ…/âŒ æµ‹è¯•ç»“æœ
- ğŸ“Š æˆåŠŸç‡ç»Ÿè®¡

### 3. Base64ç¼–ç æµ‹è¯• (`test-base64.js`)

**ç”¨é€”**: ä¸“é—¨è¯Šæ–­æˆªå›¾Base64ç¼–ç é—®é¢˜
**å‘½ä»¤**: `npm run test-base64`

**æµ‹è¯•å†…å®¹**:
- ä¸åŒå›¾ç‰‡æ ¼å¼æµ‹è¯• (WebP, PNG, JPEG)
- ä¸åŒè´¨é‡è®¾ç½®æµ‹è¯•
- Base64æ ¼å¼éªŒè¯
- MCPæ•°æ®URLæ ¼å¼æ£€æŸ¥
- æ–‡ä»¶ä¿å­˜å’Œè§£ç æµ‹è¯•

**ç”Ÿæˆæ–‡ä»¶**:
- `debug/test-screenshot-*.txt` - Base64æ–‡æœ¬
- `debug/test-screenshot-*.webp/png/jpeg` - è§£ç åçš„å›¾ç‰‡

### 4. ç»¼åˆè°ƒè¯•å·¥å…· (`debug-utils.js`)

**ç”¨é€”**: æä¾›æ‰€æœ‰è°ƒè¯•åŠŸèƒ½çš„ç»Ÿä¸€å…¥å£
**å‘½ä»¤**: `node debug/debug-utils.js`

**åŠŸèƒ½**:
- äº¤äº’å¼è°ƒè¯•æ¨¡å¼
- ç¯å¢ƒæ£€æŸ¥
- å·¥å…·å¿«æ·æ‰§è¡Œ
- ä½¿ç”¨è¯´æ˜

## ğŸ” è°ƒè¯•æ¨¡å¼

### 1. æ ‡å‡†è°ƒè¯•æ¨¡å¼

```bash
# å¯åŠ¨Node.jsè°ƒè¯•å™¨
npm run debug

# ç„¶ååœ¨Chromeä¸­æ‰“å¼€: chrome://inspect
# æˆ–åœ¨VS Codeä¸­attachåˆ°è°ƒè¯•è¿›ç¨‹
```

### 2. è¯¦ç»†æ—¥å¿—æ¨¡å¼

```bash
# å¯åŠ¨è¯¦ç»†æ—¥å¿—è¾“å‡º
npm run debug-verbose

# æŸ¥çœ‹æ‰€æœ‰è°ƒè¯•ä¿¡æ¯
DEBUG=* npm start
```

### 3. äº¤äº’å¼è°ƒè¯•

```bash
# å¯åŠ¨äº¤äº’å¼è°ƒè¯•å·¥å…·
node debug/debug-utils.js

# æˆ–æŒ‡å®šå…·ä½“åŠŸèƒ½
node debug/debug-utils.js --check
node debug/debug-utils.js --chrome
node debug/debug-utils.js --base64
```

## ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥

### Chromeè¿æ¥å¤±è´¥

**ç—‡çŠ¶**: `âŒ è¿æ¥å¤±è´¥: http://localhost:9222`

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿Chromeä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨:
   ```bash
   ./start-chrome-debug.sh
   ```

2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨:
   ```bash
   lsof -i :9222
   ```

3. éªŒè¯Chromeè°ƒè¯•æ¥å£:
   ```bash
   curl http://localhost:9222/json/version
   ```

4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### Base64éªŒè¯é”™è¯¯

**ç—‡çŠ¶**: `âŒ Base64æ ¼å¼éªŒè¯å¤±è´¥`

**è§£å†³æ–¹æ¡ˆ**:
1. è¿è¡Œä¸“é—¨çš„Base64æµ‹è¯•:
   ```bash
   npm run test-base64
   ```

2. æ£€æŸ¥ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶:
   ```bash
   ls -la debug/test-screenshot-*
   ```

3. å°è¯•ä¸åŒçš„æˆªå›¾æ ¼å¼å’Œè´¨é‡è®¾ç½®

4. æŸ¥çœ‹é”™è¯¯åˆ†æè¾“å‡º

### MCPé€šä¿¡å¤±è´¥

**ç—‡çŠ¶**: `è¯·æ±‚è¶…æ—¶` æˆ– `JSONè§£æé”™è¯¯`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥MCPæœåŠ¡å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨:
   ```bash
   npm run test
   ```

2. éªŒè¯JSONæ ¼å¼:
   ```bash
   echo '{"jsonrpc":"2.0","id":1,"method":"tools/list"}' | node build/index.js
   ```

3. ä½¿ç”¨è¯¦ç»†æ—¥å¿—æ¨¡å¼:
   ```bash
   npm run debug-verbose
   ```

### æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**: å“åº”ç¼“æ…¢æˆ–è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
1. å‡å°æµè§ˆå™¨çª—å£å¤§å°:
   ```javascript
   resize_browser("800,600")
   ```

2. é™ä½æˆªå›¾è´¨é‡:
   ```javascript
   // åœ¨browserSession.tsä¸­è°ƒæ•´
   quality: 50  // é™ä½è´¨é‡
   ```

3. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œèµ„æºä½¿ç”¨

## ğŸ“Š è°ƒè¯•æ—¥å¿—åˆ†æ

### ç†è§£æ—¥å¿—è¾“å‡º

```
ğŸ” æœåŠ¡å™¨ä¿¡æ¯: MCPæµè§ˆå™¨è‡ªåŠ¨åŒ–æœåŠ¡å™¨å¯åŠ¨ä¸­...
âœ… æœåŠ¡å™¨å¯åŠ¨å®Œæˆ
ğŸ“¤ å‘é€æµ‹è¯• "å·¥å…·åˆ—è¡¨æŸ¥è¯¢": {...}
ğŸ“¥ æ”¶åˆ°å“åº”: {...}
âœ… æµ‹è¯•é€šè¿‡: å·¥å…·åˆ—è¡¨æŸ¥è¯¢
```

### å…³é”®æ—¥å¿—æ ‡è¯†

- ğŸ” **æœåŠ¡å™¨ä¿¡æ¯**: æœåŠ¡å™¨çŠ¶æ€æ—¥å¿—
- ğŸ“¤ **å‘é€è¯·æ±‚**: å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„è¯·æ±‚
- ğŸ“¥ **æ”¶åˆ°å“åº”**: æœåŠ¡å™¨è¿”å›çš„å“åº”
- âœ… **æµ‹è¯•é€šè¿‡**: æˆåŠŸçš„æ“ä½œ
- âŒ **æµ‹è¯•å¤±è´¥**: å¤±è´¥çš„æ“ä½œ
- ğŸš¨ **è­¦å‘Šä¿¡æ¯**: éœ€è¦æ³¨æ„çš„é—®é¢˜

## ğŸ”§ é«˜çº§è°ƒè¯•æŠ€å·§

### 1. è‡ªå®šä¹‰æµ‹è¯•

åˆ›å»ºè‡ªå·±çš„æµ‹è¯•è„šæœ¬:

```javascript
// debug/my-custom-test.js
import { BrowserSession } from '../build/browserSession.js';

const session = new BrowserSession();
await session.launchBrowser();
// æ·»åŠ ä½ çš„æµ‹è¯•é€»è¾‘
```

### 2. æ¡ä»¶æ–­ç‚¹

åœ¨å…³é”®ä½ç½®æ·»åŠ æ¡ä»¶æ–­ç‚¹:

```javascript
// åœ¨src/browserSession.tsä¸­
if (process.env.DEBUG_SCREENSHOTS) {
    console.log('æˆªå›¾æ•°æ®:', screenshot.substring(0, 100));
}
```

### 3. å†…å­˜å’Œæ€§èƒ½ç›‘æ§

```bash
# å¯ç”¨Node.jsæ€§èƒ½ç›‘æ§
node --inspect --trace-warnings build/index.js
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜:

1. æŸ¥çœ‹ `README.md` çš„è¯¦ç»†è¯´æ˜
2. é˜…è¯» `ARCHITECTURE.md` äº†è§£æŠ€æœ¯æ¶æ„
3. æŸ¥çœ‹ `example-usage.md` çš„ä½¿ç”¨ç¤ºä¾‹
4. æ£€æŸ¥GitHub Issuesä¸­çš„ç±»ä¼¼é—®é¢˜

## ğŸ¯ è°ƒè¯•æ£€æŸ¥æ¸…å•

åœ¨æŠ¥å‘Šé—®é¢˜å‰ï¼Œè¯·ç¡®è®¤å·²å®Œæˆ:

- [ ] è¿è¡Œç¯å¢ƒæ£€æŸ¥: `node debug/debug-utils.js --check`
- [ ] Chromeè¿æ¥æµ‹è¯•: `npm run test-chrome`
- [ ] Base64ç¼–ç æµ‹è¯•: `npm run test-base64`
- [ ] MCPæœåŠ¡å™¨æµ‹è¯•: `npm run test`
- [ ] æŸ¥çœ‹äº†è¯¦ç»†æ—¥å¿—: `npm run debug-verbose`
- [ ] å°è¯•äº†ä¸åŒçš„é…ç½®è®¾ç½®
- [ ] æ£€æŸ¥äº†ç”Ÿæˆçš„è°ƒè¯•æ–‡ä»¶ 